<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Milla's Free</title>
    <link rel="icon" href="../imagens/milasclock.png" type="image/png" sizes="any">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <script>
        // Previne o "flash" do tema incorreto (FOUC)
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-main text-primary">

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="landing.html" class="sidebar-header">
                <img src="../imagens/millasfull.png" alt="Milla's Free Logo" class="sidebar-logo block dark:hidden">
                <img src="../imagens/millas_escuro.png" alt="Milla's Free Logo" class="sidebar-logo-dark hidden dark:block">
            </a>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-tachometer-alt"></i> <span>Painel</span></a></li>
                    <li><a href="company-dashboard.html"><i class="fas fa-users"></i> <span>Membros</span></a></li>
                    <li><a href="reports.html"><i class="fas fa-chart-pie"></i> <span>Relatórios</span></a></li>
                </ul>
            </nav>
        </aside>

        <!-- Conteúdo Principal -->
        <div class="main-content">
            <header class="main-header">
                <div class="header-actions">
                    <button id="theme-toggle" aria-label="Alternar tema" class="theme-toggle-btn">
                        <i class="fas fa-sun"></i>
                    </button>
                    <div id="profile-toggle" class="relative">
                        <button title="Configurações" class="profile-pic"></button>
                    </div>
                </div>
            </header>

            <main>
                <h1 class="text-2xl font-bold mb-6">Configurações</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Coluna da Esquerda -->
                    <div class="flex flex-col gap-8">
                        <!-- Perfil da Empresa -->
                        <div class="card">
                            <h2 class="text-xl font-semibold mb-4">Perfil da Empresa</h2>
                            <form id="profile-form">
                                <div class="mb-4">
                                    <label for="company-name" class="block text-sm font-medium mb-1">Nome da Empresa/Gestor</label>
                                    <input id="company-name" type="text" required class="w-full p-3">
                                </div>
                                <div class="mb-6">
                                    <label for="company-email" class="block text-sm font-medium mb-1">E-mail de Login</label>
                                    <input id="company-email" type="email" disabled class="w-full bg-gray-100 dark:bg-gray-800 cursor-not-allowed p-3">
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" id="save-profile-button" class="btn btn-primary w-32 text-center">
                                        <span class="button-text">Salvar</span>
                                        <i class="fas fa-spinner fa-spin hidden button-spinner"></i>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Aparência -->
                        <div class="card">
                            <h2 class="text-xl font-semibold mb-4">Aparência</h2>
                            <div class="flex justify-between items-center">
                                <p class="text-secondary">Alternar entre tema claro e escuro.</p>
                                <button id="theme-toggle-settings" aria-label="Alternar tema" class="theme-toggle-btn text-2xl">
                                    <i class="fas fa-sun"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna da Direita -->
                    <div class="flex flex-col gap-8">
                        <!-- Segurança da Conta -->
                        <div class="card">
                            <h2 class="text-xl font-semibold mb-4">Segurança da Conta</h2>
                            <form id="password-form">
                                <div class="mb-4">
                                    <label for="current-password" class="block text-sm font-medium mb-1">Senha Atual</label>
                                    <input id="current-password" type="password" required class="w-full p-3">
                                </div>
                                <div class="mb-4">
                                    <label for="new-password" class="block text-sm font-medium mb-1">Nova Senha</label>
                                    <input id="new-password" type="password" required class="w-full p-3">
                                </div>
                                <div class="mb-6">
                                    <label for="confirm-password" class="block text-sm font-medium mb-1">Confirmar Nova Senha</label>
                                    <input id="confirm-password" type="password" required class="w-full p-3">
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" id="change-password-button" class="btn btn-primary w-40 text-center">
                                        <span class="button-text">Alterar Senha</span>
                                        <i class="fas fa-spinner fa-spin hidden button-spinner"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Gerenciamento de Dados e Zona de Perigo -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Gerenciamento de Dados</h2>
                        <p class="text-secondary mb-4">Exporte todos os seus dados para arquivos CSV.</p>
                        <div class="flex justify-start">
                            <button id="export-data-button" class="btn btn-secondary">
                                <i class="fas fa-file-export mr-2"></i>
                                Exportar Todos os Dados
                            </button>
                        </div>
                    </div>
                    <div class="card danger-zone">
                        <h2 class="text-xl font-semibold mb-4 text-red-500">Zona de Perigo</h2>
                        <p class="text-secondary mb-4">A exclusão da sua conta é permanente e removerá todos os seus dados, incluindo membros, tarefas e registros de tempo.</p>
                        <div class="flex justify-start">
                            <button id="delete-account-button" class="btn btn-danger">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                Excluir Minha Conta
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals (if any are needed in the future) -->
    <div id="modals-container">
        <!-- Modal de Perfil (Reutilizável) -->
        <div id="profile-modal" class="dropdown-menu hidden z-40 !right-8 !top-[70px]">
            <div class="card p-4 w-full max-w-xs">
                <div id="user-view" class="space-y-3">
                    <div class="text-sm">
                        <p class="font-semibold" id="user-email-display">carregando...</p>
                        <div id="verification-status" class="text-xs mt-1"></div>
                    </div>
                    <hr class="border-border-color">
                    <a href="settings.html" class="block text-sm hover:text-primary"><i class="fas fa-cog w-6"></i> Configurações</a>
                    <a href="#" id="logout-button" class="block text-sm hover:text-primary"><i class="fas fa-sign-out-alt w-6"></i> Sair</a>
                </div>
            </div>
        </div>

        <!-- Message Modal -->
        <div id="message-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50 p-4">
            <div class="card p-6 w-full max-w-sm text-center">
                <p id="message-text" class="text-lg font-semibold mb-4"></p>
                <button id="message-ok" class="btn btn-primary">OK</button>
            </div>
        </div>

        <!-- Create Member Modal -->
        <div id="create-member-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50 p-4" role="dialog" aria-modal="true" aria-labelledby="create-member-title">
          <div class="card p-6 w-full max-w-md relative">
            <button id="close-create-member" class="btn-icon absolute top-4 right-4" aria-label="Fechar modal">&times;</button>

            <h3 id="create-member-title" class="text-xl font-bold mb-4">Adicionar Novo Colaborador</h3>

            <form id="create-member-form" class="space-y-4" autocomplete="off" novalidate>
              <div>
                <label for="member-name" class="block text-sm font-medium mb-1">Nome</label>
                <input id="member-name" name="member-name" type="text" required class="w-full p-2 text-sm" />
              </div>

              <div>
                <label for="member-email" class="block text-sm font-medium mb-1">Email</label>
                <input id="member-email" name="member-email" type="email" required class="w-full p-2 text-sm" />
              </div>

              <div id="create-member-feedback" class="text-sm text-red-500 hidden" role="status" aria-live="polite"></div>

              <div class="flex justify-end gap-4 mt-6">
                <button type="button" id="cancel-create-member-button" class="btn btn-secondary">Cancelar</button>

                <button type="submit" id="submit-create-member" class="btn btn-primary inline-flex items-center">
                  <span class="button-text">Adicionar</span>
                  <i class="fas fa-spinner fa-spin hidden button-spinner ml-2" aria-hidden="true"></i>
                </button>
              </div>

              <!-- Resultado / Token gerado (visível após sucesso) -->
              <div id="create-member-result" class="mt-4 hidden" aria-hidden="true">
                <label class="block text-sm font-medium mb-1">Token de Acesso (envie ao colaborador)</label>
                <div class="flex gap-2">
                  <input id="member-token" readonly class="token-input w-full p-2 text-sm" />
                  <button type="button" id="copy-member-token" class="btn btn-secondary">Copiar</button>
                </div>
                <p class="text-sm text-secondary mt-2">O colaborador usará este token para trocar por um login. O token pode ser regenerado a qualquer momento.</p>
              </div>
            </form>
          </div>
        </div>

        <!-- Edit Member Modal -->
        <div id="edit-member-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50 p-4" role="dialog" aria-modal="true" aria-labelledby="edit-member-title">
          <div class="card p-6 w-full max-w-md relative">
            <button id="close-edit-member" class="btn-icon absolute top-4 right-4" aria-label="Fechar modal">&times;</button>

            <h3 id="edit-member-title" class="text-xl font-bold mb-4">Editar Colaborador</h3>

            <form id="edit-member-form" class="space-y-4" autocomplete="off" novalidate>
              <input type="hidden" id="edit-member-id" />

              <div>
                <label for="edit-member-name" class="block text-sm font-medium mb-1">Nome</label>
                <input id="edit-member-name" type="text" required class="w-full p-2 text-sm" />
              </div>

              <div>
                <label for="edit-member-email" class="block text-sm font-medium mb-1">Email</label>
                <input id="edit-member-email" type="email" required class="w-full p-2 text-sm" />
              </div>

              <div id="edit-member-feedback" class="text-sm text-red-500 hidden" role="status" aria-live="polite"></div>

              <div class="flex justify-between items-center gap-4 mt-6">
                <div class="flex gap-2">
                  <button type="button" id="regenerate-member-token" class="btn btn-warning" title="Regenerar token">
                    <i class="fas fa-sync-alt"></i>
                    <span class="ml-2">Regenerar Token</span>
                    <i class="fas fa-spinner fa-spin hidden button-spinner ml-2" aria-hidden="true"></i>
                  </button>

                  <button type="button" id="delete-member-button" class="btn btn-danger" title="Remover colaborador">
                    <i class="fas fa-trash-alt"></i>
                    <span class="ml-2">Excluir</span>
                  </button>
                </div>

                <div class="flex gap-4">
                  <button type="button" id="cancel-edit-member-button" class="btn btn-secondary">Cancelar</button>

                  <button type="submit" id="save-edit-member-button" class="btn btn-primary inline-flex items-center">
                    <span class="button-text">Salvar Alterações</span>
                    <i class="fas fa-spinner fa-spin hidden button-spinner ml-2" aria-hidden="true"></i>
                  </button>
                </div>
              </div>

              <!-- Resultado / Token atualizado (visível após regeneração) -->
              <div id="edit-member-result" class="mt-4 hidden" aria-hidden="true">
                <label class="block text-sm font-medium mb-1">Token de Acesso</label>
                <div class="flex gap-2">
                  <input id="edit-member-token" readonly class="token-input w-full p-2 text-sm" />
                  <button type="button" id="copy-edit-member-token" class="btn btn-secondary">Copiar</button>
                </div>
                <p class="text-sm text-secondary mt-2">Envie o token atualizado ao colaborador se necessário.</p>
              </div>
            </form>
          </div>
        </div>

        <!-- Edit Task Modal -->
        <div id="edit-task-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50 p-4" role="dialog" aria-modal="true" aria-labelledby="edit-task-title">
          <div class="card p-6 w-full max-w-md relative">
            <button id="close-edit-task" class="btn-icon absolute top-4 right-4" aria-label="Fechar modal">&times;</button>

            <h3 id="edit-task-title" class="text-xl font-bold mb-4">Editar Tarefa</h3>

            <form id="edit-task-form" class="space-y-4" autocomplete="off" novalidate>
              <input type="hidden" id="edit-task-id" />

              <div>
                <label for="edit-task-name" class="block text-sm font-medium mb-1">Nome da Tarefa</label>
                <input id="edit-task-name" type="text" required class="w-full p-2 text-sm" />
              </div>

              <div id="edit-task-feedback" class="text-sm text-red-500 hidden" role="status" aria-live="polite"></div>

              <div class="flex justify-between items-center gap-4 mt-6">
                <div class="flex gap-2">
                  <button type="button" id="delete-task-button" class="btn btn-danger" title="Remover tarefa">
                    <i class="fas fa-trash-alt"></i>
                    <span class="ml-2">Excluir</span>
                  </button>
                </div>

                <div class="flex gap-4">
                  <button type="button" id="cancel-edit-task-button" class="btn btn-secondary">Cancelar</button>

                  <button type="submit" id="save-edit-task-button" class="btn btn-primary inline-flex items-center">
                    <span class="button-text">Salvar Alterações</span>
                    <i class="fas fa-spinner fa-spin hidden button-spinner ml-2" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
    </div>

    <script type="module" src="../js/settings.js"></script>
</body>
</html>